name: Defense Evasion, T1562.001 Powershell Defender disable scan feature
index_type: events
description: Detects requests to disable Microsoft Defender features using PowerShell commands
references: https://github.com/SigmaHQ/sigma/blob/ebaa1ab3f8bac6ca26543cf93c3bc0ec948a3093/rules/windows/process_creation/proc_creation_win_powershell_defender_disable_feature.yml, https://attack.mitre.org/techniques/T1562/001/
tags: defense_evasion, t1562.001
search_query: ((cmdline:Add-MpPreference\ OR cmdline:Set-MpPreference\ ) AND (cmdline:DisableArchiveScanning\ OR cmdline:DisableRealtimeMonitoring\ OR cmdline:DisableIOAVProtection\ OR cmdline:DisableBehaviorMonitoring\ OR cmdline:DisableBlockAtFirstSeen\ OR cmdline:DisableCatchupFullScan\ OR cmdline:DisableCatchupQuickScan\) AND (cmdline:"$true" OR cmdline:" 1 ")) OR (cmdline:ZGlzYWJsZWFyY2hpdmVzY2FubmluZy OR cmdline:Rpc2FibGVhcmNoaXZlc2Nhbm5pbmcg OR cmdline:kaXNhYmxlYXJjaGl2ZXNjYW5uaW5nI OR cmdline:RGlzYWJsZUFyY2hpdmVTY2FubmluZy OR cmdline:Rpc2FibGVBcmNoaXZlU2Nhbm5pbmcg OR cmdline:EaXNhYmxlQXJjaGl2ZVNjYW5uaW5nI OR cmdline:ZGlzYWJsZWJlaGF2aW9ybW9uaXRvcmluZy OR cmdline:Rpc2FibGViZWhhdmlvcm1vbml0b3Jpbmcg OR cmdline:kaXNhYmxlYmVoYXZpb3Jtb25pdG9yaW5nI OR cmdline:RGlzYWJsZUJlaGF2aW9yTW9uaXRvcmluZy OR cmdline:Rpc2FibGVCZWhhdmlvck1vbml0b3Jpbmcg OR cmdline:EaXNhYmxlQmVoYXZpb3JNb25pdG9yaW5nI OR cmdline:ZGlzYWJsZWJsb2NrYXRmaXJzdHNlZW4g OR cmdline:Rpc2FibGVibG9ja2F0Zmlyc3RzZWVuI OR cmdline:kaXNhYmxlYmxvY2thdGZpcnN0c2Vlbi OR cmdline:RGlzYWJsZUJsb2NrQXRGaXJzdFNlZW4g OR cmdline:Rpc2FibGVCbG9ja0F0Rmlyc3RTZWVuI OR cmdline:EaXNhYmxlQmxvY2tBdEZpcnN0U2Vlbi OR cmdline:ZGlzYWJsZWNhdGNodXBmdWxsc2Nhbi OR cmdline:Rpc2FibGVjYXRjaHVwZnVsbHNjYW4g OR cmdline:kaXNhYmxlY2F0Y2h1cGZ1bGxzY2FuI OR cmdline:RGlzYWJsZUNhdGNodXBGdWxsU2Nhbi OR cmdline:Rpc2FibGVDYXRjaHVwRnVsbFNjYW4g OR cmdline:EaXNhYmxlQ2F0Y2h1cEZ1bGxTY2FuI OR cmdline:ZGlzYWJsZWNhdGNodXBxdWlja3NjYW4g OR cmdline:Rpc2FibGVjYXRjaHVwcXVpY2tzY2FuI OR cmdline:kaXNhYmxlY2F0Y2h1cHF1aWNrc2Nhbi OR cmdline:RGlzYWJsZUNhdGNodXBRdWlja1NjYW4g OR cmdline:Rpc2FibGVDYXRjaHVwUXVpY2tTY2FuI OR cmdline:EaXNhYmxlQ2F0Y2h1cFF1aWNrU2Nhbi OR cmdline:ZGlzYWJsZWlvYXZwcm90ZWN0aW9uI OR cmdline:Rpc2FibGVpb2F2cHJvdGVjdGlvbi OR cmdline:kaXNhYmxlaW9hdnByb3RlY3Rpb24g OR cmdline:RGlzYWJsZUlPQVZQcm90ZWN0aW9uI OR cmdline:Rpc2FibGVJT0FWUHJvdGVjdGlvbi OR cmdline:EaXNhYmxlSU9BVlByb3RlY3Rpb24g OR cmdline:ZGlzYWJsZXJlYWx0aW1lbW9uaXRvcmluZy OR cmdline:Rpc2FibGVyZWFsdGltZW1vbml0b3Jpbmcg OR cmdline:kaXNhYmxlcmVhbHRpbWVtb25pdG9yaW5nI OR cmdline:RGlzYWJsZVJlYWx0aW1lTW9uaXRvcmluZy OR cmdline:Rpc2FibGVSZWFsdGltZU1vbml0b3Jpbmcg OR cmdline:EaXNhYmxlUmVhbHRpbWVNb25pdG9yaW5nI) OR (cmdline:RABpAHMAYQBiAGwAZQBSAGUAYQBsAHQAaQBtAGUATQBvAG4AaQB0AG8AcgBpAG4AZwAgA OR cmdline:QAaQBzAGEAYgBsAGUAUgBlAGEAbAB0AGkAbQBlAE0AbwBuAGkAdABvAHIAaQBuAGcAIA OR cmdline:EAGkAcwBhAGIAbABlAFIAZQBhAGwAdABpAG0AZQBNAG8AbgBpAHQAbwByAGkAbgBnACAA OR cmdline:RABpAHMAYQBiAGwAZQBJAE8AQQBWAFAAcgBvAHQAZQBjAHQAaQBvAG4AIA OR cmdline:QAaQBzAGEAYgBsAGUASQBPAEEAVgBQAHIAbwB0AGUAYwB0AGkAbwBuACAA OR cmdline:EAGkAcwBhAGIAbABlAEkATwBBAFYAUAByAG8AdABlAGMAdABpAG8AbgAgA OR cmdline:RABpAHMAYQBiAGwAZQBCAGUAaABhAHYAaQBvAHIATQBvAG4AaQB0AG8AcgBpAG4AZwAgA OR cmdline:QAaQBzAGEAYgBsAGUAQgBlAGgAYQB2AGkAbwByAE0AbwBuAGkAdABvAHIAaQBuAGcAIA OR cmdline:EAGkAcwBhAGIAbABlAEIAZQBoAGEAdgBpAG8AcgBNAG8AbgBpAHQAbwByAGkAbgBnACAA OR cmdline:RABpAHMAYQBiAGwAZQBCAGwAbwBjAGsAQQB0AEYAaQByAHMAdABTAGUAZQBuACAA OR cmdline:QAaQBzAGEAYgBsAGUAQgBsAG8AYwBrAEEAdABGAGkAcgBzAHQAUwBlAGUAbgAgA OR cmdline:EAGkAcwBhAGIAbABlAEIAbABvAGMAawBBAHQARgBpAHIAcwB0AFMAZQBlAG4AIA OR cmdline:ZABpAHMAYQBiAGwAZQByAGUAYQBsAHQAaQBtAGUAbQBvAG4AaQB0AG8AcgBpAG4AZwAgA OR cmdline:QAaQBzAGEAYgBsAGUAcgBlAGEAbAB0AGkAbQBlAG0AbwBuAGkAdABvAHIAaQBuAGcAIA OR cmdline:kAGkAcwBhAGIAbABlAHIAZQBhAGwAdABpAG0AZQBtAG8AbgBpAHQAbwByAGkAbgBnACAA OR cmdline:ZABpAHMAYQBiAGwAZQBpAG8AYQB2AHAAcgBvAHQAZQBjAHQAaQBvAG4AIA OR cmdline:QAaQBzAGEAYgBsAGUAaQBvAGEAdgBwAHIAbwB0AGUAYwB0AGkAbwBuACAA OR cmdline:kAGkAcwBhAGIAbABlAGkAbwBhAHYAcAByAG8AdABlAGMAdABpAG8AbgAgA OR cmdline:ZABpAHMAYQBiAGwAZQBiAGUAaABhAHYAaQBvAHIAbQBvAG4AaQB0AG8AcgBpAG4AZwAgA OR cmdline:QAaQBzAGEAYgBsAGUAYgBlAGgAYQB2AGkAbwByAG0AbwBuAGkAdABvAHIAaQBuAGcAIA OR cmdline:kAGkAcwBhAGIAbABlAGIAZQBoAGEAdgBpAG8AcgBtAG8AbgBpAHQAbwByAGkAbgBnACAA OR cmdline:ZABpAHMAYQBiAGwAZQBiAGwAbwBjAGsAYQB0AGYAaQByAHMAdABzAGUAZQBuACAA OR cmdline:QAaQBzAGEAYgBsAGUAYgBsAG8AYwBrAGEAdABmAGkAcgBzAHQAcwBlAGUAbgAgA OR cmdline:kAGkAcwBhAGIAbABlAGIAbABvAGMAawBhAHQAZgBpAHIAcwB0AHMAZQBlAG4AIA OR cmdline:RABpAHMAYQBiAGwAZQBDAGEAdABjAGgAdQBwAEYAdQBsAGwAUwBjAGEAbgA OR cmdline:RABpAHMAYQBiAGwAZQBDAGEAdABjAGgAdQBwAFEAdQBpAGMAawBTAGMAYQBuAA OR cmdline:RABpAHMAYQBiAGwAZQBBAHIAYwBoAGkAdgBlAFMAYwBhAG4AbgBpAG4AZwA)
on_hit: alert, syslog
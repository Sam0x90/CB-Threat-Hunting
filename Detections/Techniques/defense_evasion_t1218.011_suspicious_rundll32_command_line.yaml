name: Defense Evasion, T1218.001 - Suspicious rundll32 command line
index_type: events
description: Detects suspicious execution of rundll32, with specific calls to some DLLs with known LOLBIN functionalities
references:
    - https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_rundll32_susp_activity.yml
    - https://attack.mitre.org/techniques/T1218/011/
tags: defense_evasion, t1218.011
search_query: os_type:windows AND ((cmdline:javascript:* AND cmdline:.RegisterXLL*) OR (cmdline:url.dll* AND cmdline:OpenURL*) OR (cmdline:url.dll* AND cmdline:OpenURLA*) OR (cmdline:url.dll* AND cmdline:FileProtocolHandler*) OR (cmdline:zipfldr.dll* AND cmdline:RouteTheCall*) OR (cmdline:shell32.dll* AND cmdline:Control_RunDLL*) OR (cmdline:shell32.dll* AND cmdline:ShellExec_RunDLL*) OR (cmdline:mshtml.dll* AND cmdline:PrintHTML*) OR (cmdline:advpack.dll* AND cmdline:LaunchINFSection*) OR (cmdline:advpack.dll* AND cmdline:RegisterOCX*) OR (cmdline:ieadvpack.dll* AND cmdline:LaunchINFSection*) OR (cmdline:ieadvpack.dll* AND cmdline:RegisterOCX*) OR (cmdline:ieframe.dll* AND cmdline:OpenURL*) OR (cmdline:shdocvw.dll* AND cmdline:OpenURL*) OR (cmdline:syssetup.dll* AND cmdline:SetupInfObjectInstallAction*) OR (cmdline:setupapi.dll* AND cmdline:InstallHinfSection*) OR (cmdline:pcwutl.dll* AND cmdline:LaunchApplication*) OR (cmdline:dfshim.dll* AND cmdline:ShOpenVerbApplication*) OR (cmdline:dfshim.dll* AND cmdline:ShOpenVerbShortcut*) OR (cmdline:scrobj.dll* AND cmdline:GenerateTypeLib* AND cmdline:http*) OR (cmdline:shimgvw.dll* AND cmdline:ImageView_Fullscreen* AND cmdline:http*) OR (cmdline:comsvcs.dll* AND cmdline:MiniDump*)) AND -((cmdline:shell32.dll,Control_RunDLL AND cmdline:desk.cpl,screensaver,@screensaver*) OR (parent_name:control.exe AND (cmdline:Shell32.dll* AND cmdline:Control_RunDLL* AND cmdline:.cpl*)) OR (parent_name:control.exe AND cmdline:rundll32.exe AND cmdline:Shell32.dll,Control_RunDLL AND cmdline:"c:\\Windows\\System32" AND cmdline:.cpl*))
on_hit: alert, syslog